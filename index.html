<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ù…Ø­ÙˆÙ„ ÙØ§ØªØ­ Ø§Ù„Ø¹Ø¬Ù…ÙŠ â€” Ù…ÙØ­Ø¯Ù‘ÙØ« (Ø¹Ø¯Ø§Ø¯ Ø¹Ø§Ù…)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-deep:#05070a;
      --glass: rgba(15,22,36,0.85);
      --neon-purple:#bc13fe;
      --neon-blue:#00d4ff;
      --neon-green:#00ffa3;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Cairo', sans-serif; background:var(--bg-deep); color:#fff;
      display:flex; justify-content:center; padding:28px;
    }

    .app-shell{
      width:94%; max-width:440px; background:var(--glass); border-radius:36px; padding:26px;
      border:1px solid rgba(188,19,254,0.12); box-shadow:0 10px 40px rgba(0,0,0,0.6), 0 0 30px rgba(188,19,254,0.06);
      backdrop-filter: blur(14px);
    }

    .header {
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px;
    }
    .header h1{
      margin:0; font-size:1.4rem; font-weight:900; text-align:center;
      background:linear-gradient(135deg,var(--neon-purple),var(--neon-blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .sub{font-size:0.82rem; color:rgba(255,255,255,0.7); text-align:center; margin-bottom:10px}

    .visitor-badge{
      background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent); padding:8px 12px; border-radius:12px; text-align:center;
      border:1px solid rgba(255,255,255,0.03);
    }
    .visitor-badge .label{font-size:0.78rem;color:rgba(255,255,255,0.7)}
    .visitor-badge .num{font-weight:900;color:var(--neon-green);font-size:1rem}

    .nav-bar{display:flex; gap:8px; background:rgba(0,0,0,0.4); padding:6px; border-radius:18px; margin-bottom:12px;}
    .nav-btn{flex:1; padding:10px; border-radius:12px; border:none; background:none; color:#fff; font-weight:800; cursor:pointer}
    .nav-btn.active{background:linear-gradient(45deg,var(--neon-purple),var(--neon-blue)); box-shadow:0 8px 20px rgba(124,25,252,0.12)}

    .glass-box{background:rgba(0,0,0,0.35); border-radius:16px; padding:14px; margin-bottom:14px; border:1px solid rgba(255,255,255,0.03)}
    input, select{width:100%; padding:12px; border-radius:12px; border:1px solid rgba(0,212,255,0.08); background:#000; color:var(--neon-blue); font-weight:800; outline:none; text-align:center}

    .calc-row{display:flex; gap:8px; align-items:center; margin-bottom:12px}
    .sign-btn{min-width:48px; height:48px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02); color:var(--neon-green); font-weight:900; cursor:pointer}
    .del-btn{background:none;border:none;color:#ff6b6b;font-size:1.2rem;cursor:pointer}

    .result{margin-top:12px; padding:3px; border-radius:20px; background: linear-gradient(90deg, rgba(188,19,254,0.95), rgba(0,212,255,0.95), rgba(0,255,163,0.95));}
    .result-inner{border-radius:16px; padding:18px; text-align:center; background:linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.34)); border:1px solid rgba(255,255,255,0.03)}
    .val-main{font-size:2.8rem; font-weight:900; color:var(--neon-green); text-shadow:0 0 18px rgba(0,255,163,0.12); display:block}
    .muted{font-size:0.85rem; color:rgba(255,255,255,0.7); margin-top:8px}

    .segmented{display:flex; gap:8px}
    .segmented button{flex:1; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:#fff; font-weight:800; cursor:pointer}
    .segmented button.active{background:linear-gradient(45deg,var(--neon-purple),var(--neon-blue)); box-shadow:0 8px 20px rgba(124,25,252,0.12)}

    .footer{
      margin-top:20px; text-align:center; padding:12px; border-radius:14px; border:1px solid rgba(0,212,255,0.08); background:rgba(0,0,0,0.33);
      display:flex; flex-direction:column; gap:6px; align-items:center;
    }
    .footer .name{font-weight:900; color:var(--neon-blue)}
    .phone{color:#fff; font-weight:800; text-decoration:none; background:rgba(0,0,0,0.25); padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03)}
  </style>
</head>
<body>
  <div class="app-shell" role="application" aria-label="Ù…Ø­ÙˆÙ„ ÙØ§ØªØ­ Ø§Ù„Ø¹Ø¬Ù…ÙŠ">
    <div class="header">
      <div style="display:flex;flex-direction:column;gap:4px;">
        <h1>Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø³ÙˆØ±ÙŠ</h1>
        <div class="sub">ÙˆØ§Ø¬Ù‡Ø© Ø·ÙˆÙ„ÙŠÙ‘Ø© Ù…Ø­Ø³Ù‘Ù†Ø© â€” ØªØ­ÙˆÙŠÙ„ ÙˆØ­Ø§Ø³Ø¨Ø©</div>
      </div>

      <!-- PUBLIC VISITOR COUNT: visible to everyone -->
      <div class="visitor-badge" id="visitor-badge" title="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙØ±ÙŠØ¯Ø© Ø§Ù„ØªÙŠ Ø²Ø§Ø±Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹">
        <div style="text-align:right">
          <div class="label">Ø£Ø¬Ù‡Ø²Ø© Ø²Ø§Ø±Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
          <div class="num" id="visitor-count">--</div>
        </div>
      </div>
    </div>

    <div class="nav-bar" role="tablist">
      <button class="nav-btn active" onclick="tab(0,this)">ØªØ­ÙˆÙŠÙ„</button>
      <button class="nav-btn" onclick="tab(1,this)">Ø­Ø§Ø³Ø¨Ø©</button>
      <button class="nav-btn" onclick="tab(2,this)">Ø§Ù„Ø¹Ù…Ù„Ø§Øª</button>
    </div>

    <!-- ØªØ­ÙˆÙŠÙ„ -->
    <div id="s0" class="section active-sec">
      <div class="glass-box">
        <input type="number" id="amt" placeholder="0.00" oninput="doConv()" aria-label="Ø§Ù„Ù…Ø¨Ù„Øº">
        <div style="display:flex; gap:10px; margin-top:12px;">
          <select id="from" onchange="doConv()"></select>
          <select id="to" onchange="doConv()"></select>
        </div>
      </div>

      <div class="result" aria-live="polite">
        <div class="result-inner">
          <span class="val-main" id="res">0.00</span>
          <div class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù€ Ø³ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯</div>
          <div style="margin-top:12px">
            <button onclick="cls(0)" style="padding:12px;border-radius:12px;border:none;background:linear-gradient(45deg,var(--neon-purple),var(--neon-blue));color:#fff;cursor:pointer">ğŸ”„ Ù…Ø³Ø­</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø­Ø§Ø³Ø¨Ø© -->
    <div id="s1" class="section" style="display:none">
      <div id="calc-stack" style="max-height:260px; overflow:auto; margin-bottom:12px;"></div>

      <div style="display:flex; gap:10px; margin-bottom:12px;">
        <button onclick="addRow()" style="flex:1;padding:12px;border-radius:12px;border:1px solid var(--neon-purple);background:none;color:var(--neon-purple);font-weight:900;cursor:pointer">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº</button>
        <button onclick="clearAllRows()" style="padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);background:none;color:#fff;cursor:pointer">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </div>

      <div class="glass-box" style="margin-bottom:12px;">
        <select id="target" onchange="doSum()"></select>
        <div style="margin-top:10px" class="segmented" role="radiogroup" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
          <button id="op-sum" class="active" onclick="setOp('sum',this)">Ø¬Ù…Ø¹</button>
          <button id="op-sub" onclick="setOp('sub',this)">Ø·Ø±Ø­</button>
        </div>
        <div style="margin-top:8px;font-size:0.82rem;color:rgba(255,255,255,0.7)">ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø±Ø­: Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ - Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø´Ø§Ø±Ø© ÙƒÙ„ ØµÙ)</div>
      </div>

      <div class="result" aria-live="polite">
        <div class="result-inner">
          <span class="val-main" id="total">0.00</span>
          <div class="muted">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø®ØªØ§Ø±</div>
          <div style="margin-top:12px">
            <button onclick="cls(1)" style="padding:12px;border-radius:12px;border:none;background:linear-gradient(45deg,var(--neon-purple),var(--neon-blue));color:#fff;cursor:pointer">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
          </div>
        </div>
      </div>
    </div>

    <div id="s2" class="section" style="display:none">
      <div class="glass-box" style="margin-bottom:12px;">
        <input type="text" id="n-n" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" style="margin-bottom:10px;">
        <input type="number" id="n-v" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ø±Ø¬Ø¹" style="margin-bottom:10px;">
        <select id="n-r" style="margin-bottom:10px;"></select>
        <button onclick="addCur()" style="width:100%; padding:12px; border-radius:12px; border:none; background:linear-gradient(45deg,var(--neon-purple),var(--neon-blue)); color:#fff; font-weight:900; cursor:pointer">Ø¥Ø¶Ø§ÙØ© / ØªØ­Ø¯ÙŠØ«</button>
      </div>
      <div id="db-list" style="max-height:200px; overflow:auto;"></div>
    </div>

    <div class="footer">
      <span class="name">ÙØ§ØªØ­ Ø§Ù„Ø¹Ø¬Ù…ÙŠ</span>
      <a class="phone" href="tel:0930887739" aria-label="Ø§ØªØµÙ„ Ø¹Ù„Ù‰ 0930887739">0930887739 ğŸ“</a>
    </div>
  </div>

<script>
/* ---------- local DB and safe DOM helpers ---------- */
const STORAGE_KEY = 'sy_fatih_115_vertical_public';
let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
  "Ø³ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯": 1,
  "Ø¯ÙˆÙ„Ø§Ø±": 115,
  "Ø³ÙˆØ±ÙŠ Ù‚Ø¯ÙŠÙ…": 0.01
};
function saveDB(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }
function setSelectOptions(selectEl, keys){
  selectEl.innerHTML = '';
  keys.forEach(k => {
    const opt = document.createElement('option');
    opt.value = k; opt.textContent = k;
    selectEl.appendChild(opt);
  });
}

/* ---------- update dropdowns and list ---------- */
function updateDrops(){
  const keys = Object.keys(db);
  ['from','to','target','n-r'].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    const prev = el.value;
    setSelectOptions(el, keys);
    if(prev && db[prev] !== undefined) el.value = prev;
  });
  document.querySelectorAll('.r-c').forEach(s=>{
    const prev = s.value;
    setSelectOptions(s, Object.keys(db));
    if(prev && db[prev] !== undefined) s.value = prev;
  });
  renderList();
}
function renderList(){
  const container = document.getElementById('db-list');
  container.innerHTML = '';
  Object.keys(db).forEach(k=>{
    const row = document.createElement('div');
    row.style.display = 'flex'; row.style.justifyContent = 'space-between'; row.style.padding = '10px 6px'; row.style.borderBottom = '1px solid rgba(255,255,255,0.03)';
    const left = document.createElement('div');
    const strong = document.createElement('strong'); strong.textContent = `1 ${k}`;
    left.appendChild(strong);
    const sub = document.createElement('div'); sub.style.fontSize='0.82rem'; sub.style.color='rgba(255,255,255,0.6)'; sub.textContent='Ù‚ÙŠÙ…ØªÙ‡ Ø¨Ù€ Ø³ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯';
    left.appendChild(sub);
    const right = document.createElement('div'); right.style.fontWeight='900'; right.style.color='var(--neon-purple)';
    right.textContent = Number(db[k]).toLocaleString(undefined,{maximumFractionDigits:4});
    row.appendChild(left); row.appendChild(right); container.appendChild(row);
  });
}

/* ---------- conversion ---------- */
function doConv(){
  const a = parseFloat(document.getElementById('amt').value) || 0;
  const from = db[document.getElementById('from').value] || 1;
  const to = db[document.getElementById('to').value] || 1;
  const res = (a * from) / to;
  document.getElementById('res').textContent = res.toLocaleString(undefined, {maximumFractionDigits:2});
}

/* ---------- calculator rows ---------- */
function addRow(){
  const stack = document.getElementById('calc-stack');
  const d = document.createElement('div'); d.className = 'calc-row';

  const signBtn = document.createElement('button'); signBtn.className = 'sign-btn';
  const existing = stack.querySelectorAll('.calc-row').length;
  const defaultSign = (opMode === 'sub' && existing > 0) ? '-' : '+';
  signBtn.textContent = defaultSign;
  signBtn.onclick = ()=>{ signBtn.textContent = signBtn.textContent === '+' ? '-' : '+'; doSum(); };

  const inp = document.createElement('input'); inp.type='number'; inp.className='r-v'; inp.placeholder='0'; inp.oninput=doSum;
  const sel = document.createElement('select'); sel.className='r-c'; sel.onchange=doSum;

  const del = document.createElement('button'); del.className='del-btn'; del.title='Ø­Ø°Ù'; del.textContent='âœ•';
  del.onclick = ()=>{ d.remove(); doSum(); };

  d.appendChild(signBtn); d.appendChild(inp); d.appendChild(sel); d.appendChild(del);
  stack.appendChild(d);

  setSelectOptions(sel, Object.keys(db));
  sel.value = Object.keys(db)[0] || '';
  doSum();
}

function clearAllRows(){
  if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„ØºØŸ')) return;
  document.getElementById('calc-stack').innerHTML = '';
  addRow(); doSum();
}

let opMode = localStorage.getItem('ajami_opMode') || 'sum';
function setOp(mode, btn){
  opMode = mode; localStorage.setItem('ajami_opMode', opMode);
  document.querySelectorAll('.segmented button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const rows = Array.from(document.querySelectorAll('.calc-row'));
  rows.forEach((r,i)=>{
    const s = r.querySelector('.sign-btn'); if(!s) return;
    if(opMode === 'sub') s.textContent = (i===0) ? '+' : '-'; else s.textContent = '+';
  });
  doSum();
}

function doSum(){
  let total = 0;
  const rows = Array.from(document.querySelectorAll('.calc-row'));
  rows.forEach(row=>{
    const sign = row.querySelector('.sign-btn')?.textContent === '-' ? -1 : 1;
    const v = parseFloat(row.querySelector('.r-v').value) || 0;
    const cur = row.querySelector('.r-c').value;
    const rate = db[cur] || 1;
    total += sign * (v * rate);
  });
  if(rows.length === 0) { addRow(); total = 0; }
  const target = db[document.getElementById('target').value] || 1;
  const result = total / target;
  document.getElementById('total').textContent = result.toLocaleString(undefined, {maximumFractionDigits:2});
}

function cls(n){
  if(n===0){ document.getElementById('amt').value=''; doConv(); }
  else { document.getElementById('calc-stack').innerHTML=''; addRow(); doSum(); }
}

/* ---------- add currency ---------- */
function addCur(){
  const name = document.getElementById('n-n').value.trim();
  const ref = document.getElementById('n-r').value;
  const v = parseFloat(document.getElementById('n-v').value);
  if(!name || isNaN(v)){ alert('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ³Ø¹Ø± ØµØ§Ù„Ø­'); return; }
  db[name] = db[ref] * v;
  saveDB(); document.getElementById('n-n').value=''; document.getElementById('n-v').value='';
  updateDrops();
}

/* export JSON */
function exportJSON(){
  const data = JSON.stringify(db, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'ajami-currencies.json';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

/* ---------- visitor counter via CountAPI (one increment per device) ---------- */
const COUNT_NAMESPACE = 'alaa319631-ajami';
const COUNT_KEY = 'visitors';
const COUNTAPI_HIT = `https://api.countapi.xyz/hit/${encodeURIComponent(COUNT_NAMESPACE)}/${encodeURIComponent(COUNT_KEY)}`;
const COUNTAPI_GET  = `https://api.countapi.xyz/get/${encodeURIComponent(COUNT_NAMESPACE)}/${encodeURIComponent(COUNT_KEY)}`;

function displayCount(v){
  const el = document.getElementById('visitor-count');
  if(el) el.textContent = (typeof v === 'number') ? v.toLocaleString() : '--';
}

async function fetchCount(){
  try{
    const r = await fetch(COUNTAPI_GET);
    if(!r.ok) throw new Error('get failed');
    const j = await r.json();
    if(j && typeof j.value !== 'undefined') displayCount(j.value);
    else displayCount('--');
  }catch(e){
    console.warn('fetchCount error', e); displayCount('--');
  }
}

/* Hit first (if not counted) then fetch so public viewers see updated value */
async function hitCountOnce(){
  try{
    if(localStorage.getItem('ajami_counted_public')) return false;
    const r = await fetch(COUNTAPI_HIT);
    if(!r.ok) throw new Error('hit failed');
    const j = await r.json();
    if(j && typeof j.value !== 'undefined'){
      localStorage.setItem('ajami_counted_public', JSON.stringify({ts:Date.now()}));
      return true;
    }
    return false;
  }catch(e){
    console.warn('hitCountOnce error', e);
    return false;
  }
}

/* ---------- tabs handling ---------- */
function tab(n, btn){
  const sections = [document.getElementById('s0'), document.getElementById('s1'), document.getElementById('s2')];
  sections.forEach((s,i)=> s.style.display = (i===n) ? 'block' : 'none');
  document.querySelectorAll('.nav-bar .nav-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

/* ---------- init: ensure unique-increment then show count to everyone ---------- */
window.addEventListener('load', async ()=>{
  updateDrops();
  saveDB();
  if(document.getElementById('calc-stack').children.length === 0) addRow();
  if(opMode === 'sub'){ document.getElementById('op-sum').classList.remove('active'); document.getElementById('op-sub').classList.add('active'); }
  else{ document.getElementById('op-sum').classList.add('active'); document.getElementById('op-sub').classList.remove('active'); }

  // If this device hasn't been counted yet: hit first to increment then fetch updated value.
  // Otherwise just fetch current value so everyone sees the total number.
  const already = localStorage.getItem('ajami_counted_public');
  if(!already){
    await hitCountOnce(); // attempt increment (sets local flag on success)
    await fetchCount();    // read updated value
  } else {
    await fetchCount();
  }

  doConv(); doSum();
});
</script>
</body>
</html>
